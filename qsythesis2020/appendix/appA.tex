% -*-coding: utf-8 -*-

\BiAppChapter{公式定理证明}{Proofs of Equations and Theorems} \label{fulua}

待解决优化问题为“基于流量均衡的流表组合问题”（The Load-Balance-Based Table Construction Problem，LBBTC），已知其数学形式化后如下：

\begin{definition}[LBBTC]
	$K$为系统并行流水线数目，当$k\in [1,K]$，若服从：
	%
	\begin{enumerate}
		\item 基本约束，$Q_{k}\subseteq S, k\in \left[ 1,k\right],\cup Q_{k}=S;\sum ^{k}_{i=1}C_{k}\left[ i\right] \leq C_{0}\cdot R_{d} $；
		\item 流表空间占用限制，$\left| \left| \dfrac {Q_{i}}{C_{ki}}\right| -\left| \dfrac {Q_{j}}{C_{kj}}\right| \right|\cdot 100\%\leq T\left( i, j, ki, kj\in \left[ 1,k\right] \right) $；
		\item 布尔函数，$ BOOL\left(i,j\right)=
		\begin{cases}
		1& \text{ $j \in Q_i$ }\\
		0& \text{ $j \notin Q_i$}
		\end{cases}$；
		\item $G\left[ j\right] =\sum ^{k}_{i=1}BOOL\left( i,j\right) =1\left( j\in S\right)  $。
		\item $\sum _{j\in S}G\left[ i\right] =2^{P}\left( j\in S\right)  $；
		\item $D\left[ k\right] =\sum _{j\in Q_{k}}D_{-}id\left[ i\right] \left( k=1,\ldots ,K\right)  $；
		\item 优化目标1，$ F_{1}\left[ k\right] =MAX\left( D\left[ k\right] \right) -MlN\left( D\left[ k\right] \right) \leq q_1$；
		\item 优化目标2，$ F_{2}\left[ k\right] =C_{0}-\sum ^{K}_{k=1}V_{k}\leq q_{2}$；
		\item 帕累托最小优化，$ F\left[ k\right] =\left( F_{1}\left[ k\right] ,F_{2}\left[ k\right] \right) \left( k\in \left[ 1,K\right] \right)  $
	\end{enumerate}
	%
	那么对于帕累托最小优化的求解是{\hei LBBTC} 问题。 \qquad \qquad \qquad \qquad \qquad \qquad \qquad ~~ $\Diamond$
\end{definition}

本附录将证明上述问题为NP难解问题。首先引入一个经典的NP完全问题“平均分配问题”，随后附录通过给出此问题的退化过程，证明“LBBTC问题”是一个NP难问题。



\begin{theorem}%[Riesz 表示定理]
	$K$为系统并行流水线数目，当$k\in [1,K]$，对于待求问题帕累托最小优化:
	
	\begin{equation} \label{a1}
	F\left[ k\right] =\left( F_{1}\left[ k\right] ,F_{2}\left[ k\right] \right) \left( k\in \left[ 1,K\right] \right)
	\end{equation}
	是NP难问题。
\end{theorem}



\begin{proof}
		
	有用语如下：
	如果表达式$L_1$可以在多项式时间复杂度内归约到表达式$L_2$，记做$L_1 \leq_p L_2$。若有一多项式时间计算函数$f:\{0,1\}^{\ast}\rightarrow\{0,1\}^{\ast}$，则可描述为：对于任意$x\in \left\{ 0,1\right\} ^{\ast },x\in L_{1}\Leftrightarrow f\left( x\right) \in L_{2}$。
	
	
	
	
	平均分配问题(AVG\_DIV)：
	对于一个有限集合$S=\left\{ 1,2,\ldots ,n\right\}$，重量转换函数 $w:S\rightarrow \mathbb{Z} $，有如下待解问题：是否存在一个子集$S'\subseteq S$满足：
	
	\begin{equation}
	\sum_{X\in S'}w\left( x\right) =\dfrac {1}{2}\sum _{X\in S}w\left( x\right) 
	\end{equation}
	
	平均分割问题可描述如下，AVG\_DIV:=
	
	\noindent $\{ \langle  S, w\rangle  :S\subset \mathbb{N} $,
	
	\quad 函数$w$ 是 $\mathbb{N} \rightarrow \mathbb{Z} $的映射关系，
	
	\quad 存在子集 $S'\subseteq S$ 使得： 
	
	\quad $\sum_{X\in S'}w\left( x\right) =\dfrac {1}{2}\sum _{X\in S}w\left( x\right) \}$ 
	
	此经典问题AVG\_DIV已经被证明是NP难问题\citeup{cormen2009introduction}。
	
	接下来本附录将通过给出此问题的退化过程，证明“LBBTC问题”是一个NP难问题。
	令$S$是组份j所组成的集合，$S={1,2,\cdots,2^P}$。$R_d$是流表的资源消耗率；$K$是流水线并行度；$C_k(k\in [1,K])$是每个子表的设计容量；$T$个流表之间流表项利用均衡度差异；$D\_id[j](j\in S)$是属于同一个ID分组内的总流量大小：定义总共被合并掉的表项个数为$V_k$；以及两个实数变量$q_1$与$q_2$。待求问题为是否存在一个分配组合$\{Q_i\}^{K}_{i=1}$可满足下列约束条件：
	
	\begin{align}\label{a2}
	&Q_{k}\subseteq S, k\in \left[ 1,k\right],\cup Q_{k}=S;\sum ^{k}_{i=1}C_{k}\left[ i\right] \leq C_{0}\cdot R_{d}  \\
	&\left| \left| \dfrac {Q_{i}}{C_{ki}}\right| -\left| \dfrac {Q_{j}}{C_{kj}}\right| \right|\cdot 100\%\leq T\left( i, j, ki, kj\in \left[ 1,k\right] \right)  \\
	&BOOL\left(i,j\right)=
	\begin{cases}
	1& \text{ $j \in Q_i$ }\\
	0& \text{ $j \notin Q_i$}
	\end{cases}\\
	&G\left[ j\right] =\sum ^{k}_{i=1}BOOL\left( i,j\right) =1\left( j\in S\right) \\
	&\sum _{j\in S}G\left[ i\right] =2^{P}\left( j\in S\right) \\
	&D\left[ k\right] =\sum _{j\in Q_{k}}D_{-}id\left[ i\right] \left( k=1,\ldots ,K\right)\\
	&F_{1}\left[ k\right] =MAX\left( D\left[ k\right] \right) -MlN\left( D\left[ k\right] \right) \leq q_1 \\
	&F_{2}\left[ k\right] =C_{0}-\sum ^{K}_{k=1}V_{k}\leq q_{2} 
	\end{align}
	
	帕累托最小优化函数：
	
	\begin{equation} \label{a3}
	F\left[ k\right] =\left( F_{1}\left[ k\right] ,F_{2}\left[ k\right] \right) \left( k\in \left[ 1,K\right] \right)
	\end{equation}
	
	
	平均分割问题（LBBTC）可描述如下，AVG\_DIV:=
	
	\noindent $\{ \langle  S, K, Rd, C_k, T, D\_id, V_k, q_1, q_2\rangle:  $
	
	\ \ ID组份组成了集合$S=\left\{ 1,2,\ldots ,2^p\right\}$，
	
	\ \ 并行流表个数$K\in \mathbb{N}$，
	
	\ \ 系统内流表资源冗余度$Rd \in \mathbb{R}$，
	
	\ \ $T \in \mathbb{N}$ 个流表之间流表项利用均衡度差异（单位：条），
	
	\ \ $D\_id$ 为 $S \rightarrow \mathbb{R}$的映射，表示以不同=ID分组的流量分布，
	
	\ \ $C_k$为每个流表的容量，
	
	\ \ 在流表拆分后，$V_k$表示每个流表内，最终可被重新合并的流表项个数， 
	
	\ \ $q_1$,$q_2 \in \mathbb{R}$, 存在一个分配规则 $\{Q_i\}^{K}_{i=1}$ 满足LBBCD问题所描述的约束条件。$\}$
	
	使用描述语言定义LBBCD问题，AVG\_DIV:=
	
	为说明 AVG\_DIV $\leq_p$ LBBCD，即AVG\_DIV可被归约到LBBCD问题。令$\langle S_1, w \rangle$为是AVG\_DIV的一个实例，可以继续构造一个LBBCD的实例如 $\langle  S, K, Rd, C_k, T, D\_id,\\ V_k, 
	q_1, q_2\rangle$如下：
	
	令：$S = S_1$,
	$D\_id[i] = w(i) (i \in S_1)$,
	$K = 2$, 
	$Rd = 1$,
	$T = \infty$, 
	$q_1 = 0$,
	$V_k = 0$, $C_{k}=\dfrac {C_{0}}{K}$, $q_2 = C_0$，由于$T$, $q_2$, 为常数，第二个和第八个约束条件释放，利用第4和第5个约束条件，可得到：$Q_1 \cap Q_2=\phi$，因此约束条件变为：
	
	
	\begin{align}\label{a4}
	&Q_1 \cup Q_2=S_1  \\
	&Q_1 \cap Q_2=\phi  \\
	&D\left[ j\right] :=\sum _{x\in Q_{j}}w(x) \left( j=1,2\right)\\
	&F_1:Max(D[j])-Min(D[j])=0 \nonumber \\
	\Leftrightarrow \ &D[1]=D[2]=\dfrac{1}{2}\sum_{x\in S_1}w(x) 
	\end{align}
	
	接下来说明当且仅当$\langle S_1, 2, 1, \dfrac {C_0}{K}, \infty, w, 0, 0, C_0 \rangle \in $ LBBCD时，有$\langle S_1, w\rangle \\
	\in $ AVG\_DIV：
	
	如果存在一组分配机制${Q_1, Q_2}$使得上述约束条件得到满足，则令$S'_1=Q_1$，根据约束A-13,A-14，$\sum_{x\in S'_1}w(x)=\dfrac{1}{2}\sum _{x \in S_1}w(x)$。另一方面，如果存在一个子集$S'_1( S'_1 \subseteq S_1)$，满足$\sum_{x\in S'_1}w(x)=\dfrac{1}{2}\sum _{x \in S_1}w(x)$，则当$Q_1=S'_1$ 且 $Q_2=S_1-S'_1$，显然约束条件A-12至A-15全部满足。所以AVG\_DIV 归约到 LBBCD，LBBCD同样为NP难问题。
\end{proof}
